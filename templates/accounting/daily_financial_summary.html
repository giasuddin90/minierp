{% extends 'base.html' %}

{% block title %}Daily Financial Summary - Building Materials ERP{% endblock %}

{% block page_title %}Daily Financial Summary - {{ today|date:"F d, Y" }}{% endblock %}

{% block page_actions %}
<div class="btn-group">
    <a href="{% url 'accounting:enhanced_trial_balance' %}" class="btn btn-outline-info">
        <i class="bi bi-calculator"></i> Trial Balance
    </a>
    <a href="{% url 'accounting:banking_dashboard' %}" class="btn btn-outline-primary">
        <i class="bi bi-speedometer2"></i> Banking Dashboard
    </a>
    <a href="{% url 'accounting:expense_create' %}" class="btn btn-outline-danger">
        <i class="bi bi-plus-circle"></i> Add Expense
    </a>
    <a href="{% url 'accounting:income_create' %}" class="btn btn-outline-success">
        <i class="bi bi-plus-circle"></i> Add Income
    </a>
</div>
{% endblock %}

{% block content %}
<!-- Financial Summary Cards -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body text-center">
                <h6 class="card-title">Total Income</h6>
                <h3 class="mb-0">৳{{ total_income|floatformat:2 }}</h3>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-danger text-white">
            <div class="card-body text-center">
                <h6 class="card-title">Total Expenses</h6>
                <h3 class="mb-0">৳{{ total_expenses|floatformat:2 }}</h3>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-info text-white">
            <div class="card-body text-center">
                <h6 class="card-title">Bank Inflow</h6>
                <h3 class="mb-0">৳{{ total_bank_inflow|floatformat:2 }}</h3>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-warning text-white">
            <div class="card-body text-center">
                <h6 class="card-title">Net Cash Flow</h6>
                <h3 class="mb-0 {% if net_cash_flow >= 0 %}text-success{% else %}text-danger{% endif %}">
                    ৳{{ net_cash_flow|floatformat:2 }}
                </h3>
            </div>
        </div>
    </div>
</div>

<!-- Category Breakdown -->
<div class="row mb-4">
    <!-- Expense Categories -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="bi bi-arrow-down-circle text-danger"></i>
                    Expenses by Category
                </h6>
            </div>
            <div class="card-body">
                {% if expense_by_category %}
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Amount</th>
                                <th>Percentage</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for category, amount in expense_by_category.items %}
                            <tr>
                                <td>{{ category }}</td>
                                <td class="text-danger">৳{{ amount|floatformat:2 }}</td>
                                <td>
                                    {% if total_expenses > 0 %}
                                        {% widthratio amount total_expenses 100 %}%
                                    {% else %}
                                        0%
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot>
                            <tr class="table-danger">
                                <td><strong>Total Expenses:</strong></td>
                                <td><strong>৳{{ total_expenses|floatformat:2 }}</strong></td>
                                <td><strong>100%</strong></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-3">
                    <i class="bi bi-arrow-down-circle text-muted"></i>
                    <p class="text-muted mb-0">No expenses today</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Income Categories -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="bi bi-arrow-up-circle text-success"></i>
                    Income by Category
                </h6>
            </div>
            <div class="card-body">
                {% if income_by_category %}
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Amount</th>
                                <th>Percentage</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for category, amount in income_by_category.items %}
                            <tr>
                                <td>{{ category }}</td>
                                <td class="text-success">৳{{ amount|floatformat:2 }}</td>
                                <td>
                                    {% if total_income > 0 %}
                                        {% widthratio amount total_income 100 %}%
                                    {% else %}
                                        0%
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot>
                            <tr class="table-success">
                                <td><strong>Total Income:</strong></td>
                                <td><strong>৳{{ total_income|floatformat:2 }}</strong></td>
                                <td><strong>100%</strong></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-3">
                    <i class="bi bi-arrow-up-circle text-muted"></i>
                    <p class="text-muted mb-0">No income today</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Detailed Transactions -->
<div class="row">
    <!-- Bank Transactions -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="bi bi-bank"></i>
                    Bank Transactions
                </h6>
            </div>
            <div class="card-body">
                {% if bank_transactions %}
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Type</th>
                                <th>Amount</th>
                                <th>Bank</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for transaction in bank_transactions %}
                            <tr>
                                <td>{{ transaction.transaction_date|date:"H:i" }}</td>
                                <td>
                                    <span class="badge 
                                        {% if transaction.transaction_type == 'deposit' %}bg-success
                                        {% elif transaction.transaction_type == 'withdrawal' %}bg-danger
                                        {% elif transaction.transaction_type == 'transfer_in' %}bg-info
                                        {% else %}bg-warning{% endif %}">
                                        {{ transaction.get_transaction_type_display }}
                                    </span>
                                </td>
                                <td>৳{{ transaction.amount|floatformat:2 }}</td>
                                <td>{{ transaction.bank_account.name }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-3">
                    <i class="bi bi-bank text-muted"></i>
                    <p class="text-muted mb-0">No bank transactions today</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Income Details -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="bi bi-arrow-up-circle text-success"></i>
                    Income Details
                </h6>
            </div>
            <div class="card-body">
                {% if incomes %}
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Amount</th>
                                <th>Method</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for income in incomes %}
                            <tr>
                                <td>
                                    <span class="badge bg-success">{{ income.income_category.name }}</span>
                                </td>
                                <td class="text-success">৳{{ income.amount|floatformat:2 }}</td>
                                <td>{{ income.get_payment_method_display }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-3">
                    <i class="bi bi-arrow-up-circle text-muted"></i>
                    <p class="text-muted mb-0">No income today</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Expense Details -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="bi bi-arrow-down-circle text-danger"></i>
                    Expense Details
                </h6>
            </div>
            <div class="card-body">
                {% if expenses %}
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Amount</th>
                                <th>Method</th>
                                <th>Description</th>
                                <th>Reference</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for expense in expenses %}
                            <tr>
                                <td>
                                    <span class="badge bg-warning">{{ expense.expense_category.name }}</span>
                                </td>
                                <td class="text-danger">৳{{ expense.amount|floatformat:2 }}</td>
                                <td>{{ expense.get_payment_method_display }}</td>
                                <td>{{ expense.description|truncatechars:30 }}</td>
                                <td>{{ expense.reference|default:"-" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-3">
                    <i class="bi bi-arrow-down-circle text-muted"></i>
                    <p class="text-muted mb-0">No expenses today</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="bi bi-lightning"></i>
                    Quick Actions
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <a href="{% url 'accounting:expense_create' %}" class="btn btn-danger w-100">
                            <i class="bi bi-plus-circle"></i><br>
                            Add Expense
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="{% url 'accounting:income_create' %}" class="btn btn-success w-100">
                            <i class="bi bi-plus-circle"></i><br>
                            Add Income
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="{% url 'accounting:enhanced_trial_balance' %}" class="btn btn-info w-100">
                            <i class="bi bi-calculator"></i><br>
                            Trial Balance
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="{% url 'accounting:banking_dashboard' %}" class="btn btn-primary w-100">
                            <i class="bi bi-speedometer2"></i><br>
                            Banking Dashboard
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
